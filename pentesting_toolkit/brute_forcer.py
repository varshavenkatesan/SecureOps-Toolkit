#!/usr/bin/env python3
"""
Brute Force Simulator
=====================
Educational demonstration of brute force authentication attacks.

Author: Varsha Venkatesan
Purpose: Educational ONLY - Understanding attack vectors

‚ö†Ô∏è CRITICAL WARNING ‚ö†Ô∏è
This is a SIMULATION for educational purposes only.
Do NOT use against real systems without explicit authorization.
Brute force attacks are illegal and unethical without permission.
"""

import time
import hashlib
from datetime import datetime

from utils import print_banner, print_section, confirm_action, sanitize_input


class BruteForceSimulator:
    """
    Simulates brute force authentication attacks for educational purposes.
    Uses dummy credentials and local validation only.
    """
    
    def __init__(self):
        """Initialize the brute force simulator."""
        self.attempts = 0
        self.max_attempts = 100
        self.success = False
        
        # Dummy credentials for simulation (DO NOT use real credentials!)
        self.dummy_users = {
            'admin': self._hash_password('admin123'),
            'user': self._hash_password('password'),
            'test': self._hash_password('test123'),
            'root': self._hash_password('root'),
            'guest': self._hash_password('guest'),
        }
    
    def _hash_password(self, password):
        """
        Hash a password using SHA-256.
        
        Args:
            password (str): Plain text password
            
        Returns:
            str: Hashed password
        """
        return hashlib.sha256(password.encode()).hexdigest()
    
    def check_credentials(self, username, password):
        """
        Check if credentials match (simulation only).
        
        Args:
            username (str): Username to check
            password (str): Password to check
            
        Returns:
            bool: True if credentials match
        """
        self.attempts += 1
        
        # Simulate network delay
        time.sleep(0.1)
        
        # Check if username exists and password matches
        if username in self.dummy_users:
            password_hash = self._hash_password(password)
            return password_hash == self.dummy_users[username]
        
        return False
    
    def dictionary_attack(self, username, wordlist):
        """
        Simulate a dictionary-based brute force attack.
        
        Args:
            username (str): Target username
            wordlist (list): List of passwords to try
        """
        print_section("DICTIONARY ATTACK SIMULATION")
        
        print(f"[*] Target Username: {username}")
        print(f"[*] Wordlist Size: {len(wordlist)} passwords")
        print(f"[*] Starting attack simulation...")
        print()
        
        start_time = time.time()
        
        for password in wordlist:
            if self.attempts >= self.max_attempts:
                print(f"\n[!] Maximum attempts reached ({self.max_attempts})")
                break
            
            print(f"[{self.attempts+1:03d}] Trying: {username}:{password}", end='')
            
            if self.check_credentials(username, password):
                elapsed = time.time() - start_time
                print(" ‚úì SUCCESS!")
                print(f"\n[+] Valid credentials found!")
                print(f"[+] Username: {username}")
                print(f"[+] Password: {password}")
                print(f"[+] Attempts: {self.attempts}")
                print(f"[+] Time: {elapsed:.2f} seconds")
                self.success = True
                return
            else:
                print(" ‚úó Failed")
        
        elapsed = time.time() - start_time
        
        if not self.success:
            print(f"\n[-] Attack failed - No valid credentials found")
            print(f"[-] Total attempts: {self.attempts}")
            print(f"[-] Time elapsed: {elapsed:.2f} seconds")
    
    def generate_common_passwords(self):
        """
        Generate a list of common/weak passwords.
        
        Returns:
            list: Common passwords for testing
        """
        common_passwords = [
            # Very common passwords (NEVER use these!)
            'password',
            '123456',
            '12345678',
            'qwerty',
            'abc123',
            'password123',
            'admin',
            'letmein',
            'welcome',
            'monkey',
            
            # Pattern-based
            '111111',
            '123123',
            'admin123',
            'root',
            'test',
            'test123',
            'user',
            'pass',
            'guest',
            '1234',
            
            # Context-specific (related to username)
            'admin',
            'administrator',
        ]
        
        return common_passwords
    
    def demonstrate_attack(self):
        """
        Run a demonstration of the brute force attack.
        """
        print_banner("BRUTE FORCE ATTACK DEMONSTRATION")
        
        print("\n‚ÑπÔ∏è  EDUCATIONAL DEMONSTRATION")
        print("This is a simulated attack on LOCAL dummy credentials.")
        print("No real systems are being attacked.\n")
        
        # Choose target username
        print("Available dummy accounts:")
        for username in self.dummy_users.keys():
            print(f"  - {username}")
        
        target_user = input("\nSelect target username (or press Enter for 'admin'): ").strip()
        
        if not target_user:
            target_user = 'admin'
        
        target_user = sanitize_input(target_user)
        
        # Generate wordlist
        wordlist = self.generate_common_passwords()
        
        # Add username-based variations
        wordlist.append(target_user)
        wordlist.append(f"{target_user}123")
        wordlist.append(f"{target_user}@123")
        
        print(f"\n[*] Target: {target_user}")
        print(f"[*] Wordlist: {len(wordlist)} passwords")
        
        if not confirm_action("\n[?] Start simulated attack?"):
            print("[*] Demonstration cancelled.")
            return
        
        # Run the attack
        self.dictionary_attack(target_user, wordlist)
        
        # Educational insights
        self.show_educational_insights()
    
    def show_educational_insights(self):
        """
        Display educational information about brute force attacks.
        """
        print_section("EDUCATIONAL INSIGHTS")
        
        print("\nüìö What is Brute Force?")
        print("   Brute force is a trial-and-error method used to obtain")
        print("   information such as passwords or encryption keys.")
        
        print("\nüéØ Types of Brute Force Attacks:")
        print("   1. Dictionary Attack - Uses list of common passwords")
        print("   2. Credential Stuffing - Reuses leaked credentials")
        print("   3. Password Spraying - Few passwords, many accounts")
        print("   4. Pure Brute Force - Tries all combinations")
        
        print("\n‚ö†Ô∏è  Real-World Impact:")
        print("   - Unauthorized access to accounts")
        print("   - Data breaches and theft")
        print("   - Identity theft")
        print("   - Financial fraud")
        
        print("\nüõ°Ô∏è  Defense Mechanisms:")
        print("   1. Strong Password Policies")
        print("      - Minimum 12+ characters")
        print("      - Mix of upper/lower/numbers/symbols")
        print("      - No dictionary words")
        
        print("\n   2. Account Lockout Policies")
        print("      - Lock account after N failed attempts")
        print("      - Temporary lockout (e.g., 15 minutes)")
        print("      - Permanent lockout + manual review")
        
        print("\n   3. Rate Limiting")
        print("      - Limit login attempts per time period")
        print("      - Increase delay after failed attempts")
        print("      - CAPTCHA after suspicious activity")
        
        print("\n   4. Multi-Factor Authentication (MFA)")
        print("      - Something you know (password)")
        print("      - Something you have (phone/token)")
        print("      - Something you are (biometrics)")
        
        print("\n   5. Monitoring & Alerting")
        print("      - Log all authentication attempts")
        print("      - Alert on suspicious patterns")
        print("      - IP-based blocking/throttling")
        
        print("\n   6. Additional Measures")
        print("      - Password managers")
        print("      - Passwordless authentication")
        print("      - Biometric authentication")
        print("      - Security questions (used carefully)")
        
        print("\nüîç Detection Indicators:")
        print("   - Multiple failed logins from same IP")
        print("   - Failed logins across multiple accounts")
        print("   - Login attempts at unusual times")
        print("   - Geographic anomalies")
        
        print("\n‚öñÔ∏è  Legal Considerations:")
        print("   - Unauthorized access is ILLEGAL")
        print("   - Computer Fraud and Abuse Act (CFAA)")
        print("   - Can result in fines and imprisonment")
        print("   - Always obtain written authorization")
        
        print("\nüí° Best Practices for Users:")
        print("   ‚úì Use unique passwords for each account")
        print("   ‚úì Use password managers")
        print("   ‚úì Enable MFA wherever possible")
        print("   ‚úì Use passphrases (e.g., 'correct-horse-battery-staple')")
        print("   ‚úì Never share passwords")
        print("   ‚úì Change passwords if breached")
        
        print("\nüí° Best Practices for Developers:")
        print("   ‚úì Implement account lockout policies")
        print("   ‚úì Use strong password hashing (bcrypt, Argon2)")
        print("   ‚úì Never store plaintext passwords")
        print("   ‚úì Implement rate limiting")
        print("   ‚úì Log authentication events")
        print("   ‚úì Require MFA for sensitive accounts")


def main():
    """
    Main function to run the brute force simulator interactively.
    """
    print_banner("BRUTE FORCE ATTACK SIMULATOR")
    
    print("\n‚ö†Ô∏è  EDUCATIONAL PURPOSE ONLY ‚ö†Ô∏è")
    print("This is a SAFE SIMULATION using local dummy credentials.")
    print("Do NOT attempt real brute force attacks - they are ILLEGAL!")
    print("\nThis tool teaches:")
    print("  ‚Ä¢ How brute force attacks work")
    print("  ‚Ä¢ Why strong passwords matter")
    print("  ‚Ä¢ How to defend against these attacks\n")
    
    if not confirm_action("[?] Do you understand this is for education only?"):
        print("[!] Demonstration cancelled.")
        return
    
    # Create simulator
    simulator = BruteForceSimulator()
    
    # Run demonstration
    try:
        simulator.demonstrate_attack()
    except KeyboardInterrupt:
        print("\n\n[!] Simulation interrupted by user")
    except Exception as e:
        print(f"\n[ERROR] Simulation failed: {e}")
    
    print("\n[*] Simulation complete!")
    print("\n" + "="*60)
    print("Remember: Use this knowledge ethically and responsibly!")
    print("="*60)


if __name__ == "__main__":
    main()
